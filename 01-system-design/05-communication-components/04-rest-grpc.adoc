= REST and gRPC Work Together
OtÃ¡vio Santana
:toc: left
:icons: font
:sectnums:
:kroki-server-url: https://kroki.io


==  C4Context â€“ REST Payment Integration

[source, mermaid]
----
C4Context
title System Context â€“ Hybrid REST + gRPC Integration

Enterprise_Boundary(company, "Company System") {
    Person(customer, "ğŸ§‘ Customer", "Places orders via web or mobile")

    System(backend, "ğŸŸ¦ Java Backend", "Handles checkout, payment, and stock coordination")

    System_Boundary(internal, "Internal Services") {
        System(stock_service, "ğŸ“¦ Stock Service", "Validates stock availability")
        SystemDb(stock_db, "ğŸ—ƒï¸ Inventory DB", "Stores stock levels")
    }
}

System_Ext(payment_provider, "ğŸ’³ Payment Provider", "External REST API for payment processing")

Rel(customer, backend, "Places order", "HTTPS/REST")
Rel(backend, payment_provider, "Initiates payment", "HTTPS/REST")
Rel(payment_provider, backend, "Webhook (confirmation)", "HTTPS/REST")
Rel(backend, stock_service, "checkAvailability()", "gRPC")
Rel(stock_service, stock_db, "Reads/Writes", "SQL")

UpdateLayoutConfig($c4ShapeInRow="2", $c4BoundaryInRow="1")
----

==  C4Container â€“ REST Payment Integration

[source, mermaid]
----
C4Container
title Container Diagram â€“ REST for Payment, gRPC for Stock

Person(customer, "ğŸ§‘ Customer", "Uses the system to shop and pay")

System_Ext(payment_provider, "ğŸ’³ Payment Provider", "External payment gateway (e.g., Stripe)")

Container_Boundary(app, "Company Backend System") {
    Container(client_app, "Client App", "React / Mobile", "Provides UI for shopping and payment")
    Container(backend, "Java Backend", "Spring Boot", "Handles requests and business logic")
    Container(stock_service, "Stock Service", "Java + gRPC", "Manages inventory availability")
    ContainerDb(stock_db, "Inventory DB", "PostgreSQL", "Stores stock info")
}

Rel(customer, client_app, "Uses", "HTTPS")
Rel(client_app, backend, "Places order", "HTTPS/REST")
Rel(backend, payment_provider, "REST payment", "HTTPS")
Rel(payment_provider, backend, "Sends webhook", "HTTPS")
Rel(backend, stock_service, "checkAvailability()", "gRPC")
Rel(stock_service, stock_db, "Reads/Writes", "SQL")

UpdateLayoutConfig($c4ShapeInRow="3", $c4BoundaryInRow="1")
----


== Sequence Diagram: Inventory Check via gRPC

[source, mermaid]
----
sequenceDiagram
    participant ğŸ§‘ Client
    participant ğŸŸ¦ Java Backend
    participant ğŸ’³ Payment Provider
    participant ğŸ“¦ Stock Service
    participant ğŸ—ƒï¸ Inventory DB

    ğŸ§‘ Client->>ğŸŸ¦ Java Backend: POST /checkout (REST)
    ğŸŸ¦ Java Backend->>ğŸ“¦ Stock Service: gRPC checkAvailability(productId)
    ğŸ“¦ Stock Service->>ğŸ—ƒï¸ Inventory DB: SELECT stock
    ğŸ—ƒï¸ Inventory DB-->>ğŸ“¦ Stock Service: Stock data
    ğŸ“¦ Stock Service-->>ğŸŸ¦ Java Backend: Stock OK

    ğŸŸ¦ Java Backend->>ğŸ’³ Payment Provider: POST /payments (REST)
    ğŸ’³ Payment Provider-->>ğŸŸ¦ Java Backend: Payment Response
    note over ğŸ’³ Payment Provider,ğŸŸ¦ Java Backend: Later... webhook event
    ğŸ’³ Payment Provider-->>ğŸŸ¦ Java Backend: POST /webhook/payment

    ğŸŸ¦ Java Backend-->>ğŸ§‘ Client: Order accepted
----